# 无人机坠落轨迹模拟程序使用指南

## 1. 程序解决的问题

本程序主要解决题目中 **“定位 (Positioning)”** 部分的任务：

> **题目要求**：开发一个模型，预测无人机随时间变化的位置。与这些预测相关的不确定性因素是什么？

**本程序的解决方案**：
1.  **物理建模**：使用微分方程（ODE）描述无人机在重力、空气阻力和风力作用下的运动轨迹。
2.  **不确定性量化**：通过 **蒙特卡洛模拟 (Monte Carlo Simulation)**，多次随机生成初始条件和环境参数，模拟出成百上千种可能的坠落路径。
3.  **结果输出**：生成坠落点的概率分布图（热力图），直观展示无人机最可能掉落的区域，为后续的搜索策略提供数据支持。

---

## 2. 程序运行流程图

以下流程图展示了 `drone_simulation.py` 的核心逻辑：

```mermaid
graph LR
    B["初始化无人机物理参数<br>(质量, 迎风面积, 阻力系数)"] --> C["设置模拟次数 N"]
    C --> D{循环 N 次}
    
    D -->|每次迭代| E["随机生成初始状态<br>(位置误差, 初始速度)"]
    E --> F["随机生成环境参数<br>(风速, 风向, 垂直气流)"]
    
    F --> G["求解微分方程 "]
    G --> H{检测是否撞地}
    
    H -->|否| G
    H -->|是| I["记录撞击点坐标"]
    
    I --> J{达到 N 次?}
    J -->|否| D
    J -->|是| K[汇总撞击点数据]
    
    K --> L[绘制散点图与热力图]
```

---

## 3. 如何修改参数以匹配特定场景

你可以通过修改 `drone_simulation.py` 中的特定代码行来模拟不同的场景。

### 3.1 修改无人机硬件参数
如果你知道无人机的具体型号（例如大疆 Mavic 或大型固定翼），可以在 `DroneSimulation` 类初始化时修改。

**代码位置**：`class DroneSimulation` 的 `__init__` 方法。

```python
# 原始代码
def __init__(self, mass=2.0, area=0.1, cd=0.5):

# 修改示例：模拟更重、更大的无人机
# mass: 质量 (kg)
# area: 迎风面积 (m^2)
# cd: 空气阻力系数 (流线型越低，方形越高)
def __init__(self, mass=5.0, area=0.2, cd=0.6): 
```

### 3.2 修改初始飞行状态
修改无人机失联时的状态。例如，它是悬停时掉落，还是高速飞行时掉落？

**代码位置**：`run_monte_carlo` 函数中的 `Step 1` 部分。

```python
# --- 修改高度 ---
# 原始：500米高空
z0 = np.random.normal(500, 10) 
# 修改：低空飞行 (100米)
z0 = np.random.normal(100, 5)

# --- 修改速度 ---
# 原始：巡航速度 15m/s
vx0 = np.random.normal(15, 2)
# 修改：悬停失控 (速度接近 0)
vx0 = np.random.normal(0, 0.5)
vy0 = np.random.normal(0, 0.5)
```

### 3.3 修改环境风场
山区的天气多变，风是影响落点分布最大的因素。

**代码位置**：`run_monte_carlo` 函数中的 `Step 2` 部分。

```python
# --- 修改风速 ---
# 原始：中等风速 (均值 5m/s)
wind_mag = np.abs(np.random.normal(5, 2))
# 修改：强风暴 (均值 15m/s，波动大)
wind_mag = np.abs(np.random.normal(15, 5))

# --- 修改风向 ---
# 原始：随机风向 (0 到 2pi)
wind_angle = np.random.uniform(0, 2 * np.pi)
# 修改：固定吹向东方 (风向 0度，只有小幅波动)
wind_angle = np.random.normal(0, 0.1) 
```

### 3.4 修改地形 (进阶)
目前的模型假设地面是平的 ($z=0$)。你可以加入山坡。

**代码位置**：`terrain_height` 方法。

```python
# 原始：平地
return 0.0

# 修改：简单的上坡 (坡度 10%)
return 0.1 * x 

# 修改：起伏的山地 (使用正弦函数模拟)
return 50 * np.sin(x / 100) + 50 * np.cos(y / 100)
```

---

## 4. 总结

这份代码是你论文 **Model Development** 章节的核心实现。
*   **输入**：无人机参数、最后已知状态、环境预估。
*   **核心机制**：牛顿第二定律 + 蒙特卡洛随机采样。
*   **输出**：搜索区域的热力图。

在论文中，你可以展示不同参数设置下的多张热力图（例如“晴天 vs 暴风雨”），以此来回答题目中关于“不确定性因素”的讨论。
